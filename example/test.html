<!DOCTYPE html>
<html>
  <head>
      <script type="text/javascript" src="../flow.js"></script>
  </head>
  <body>
      <script type="text/javascript">
        window.onload = function () {
            flow(function (errs, results, fl) {
                //Do some async operations
                for (var i = 2; i > 0; i -= 1) {
                    fl.inc();
                    setTimeout(function () {
                        fl.tick(null, this.index);
                    }.bind({index: i}), Math.random() * 100);
                }
                console.log('Task 1 completed.');
            }, function (errs, results, fl) {
                console.log(errs);
                console.log(results);
                console.log('Task 2 completed.');
                fl.next();
            }, function (errs, results, fl) {
                var repeat = (fl.repeatCount < 2);
                fl.set(2, repeat); //if repeat = true, then when tick() reaches zero, it will repeat this task again.
                //Do some async operations
                for (var i = 2; i > 0; i -= 1) {
                    setTimeout(function () {
                        fl.tick(null, this.index);
                    }.bind({index: i}), Math.random() * 100);
                }
                console.log('Task 3 completed.');
            }, function (errs, results) {
                console.log(errs);
                console.log(results);
                console.log('Task 4 completed.');
                console.log('Done');
            })();
        };
      </script>
  </body>
</html>
